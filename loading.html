<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jumanji: Digital Odyssey - Loading</title>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Creepster&family=Permanent+Marker&family=Roboto:wght@400;500;700&family=Orbitron:wght@400;700;900&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --primary-green: #2d5016;
            --dark-green: #1a3009;
            --light-green: #4a7c2e;
            --accent-gold: #d4af37;
            --accent-red: #8b0000;
            --text-light: #f5f5dc;
            --text-dark: #333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--primary-green);
            color: var(--text-light);
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .video-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -2;
            overflow: hidden;
        }

        .video-background iframe {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 120vw;
            height: 120vh;
            min-width: 100vw;
            min-height: 100vh;
            transform: translateX(-50%) translateY(-50%);
            pointer-events: none;
        }

        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.6) 0%, rgba(0, 0, 0, 0.8) 100%);
            z-index: -1;
        }

        .content-wrapper {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 1rem;
            z-index: 1;
            position: relative;
        }

        .top-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            width: 100%;
        }

        .team-info {
            background-color: rgba(26, 48, 9, 0.9);
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px solid var(--accent-gold);
            max-width: 160px;
        }

        .team-name {
            font-family: 'Orbitron', monospace;
            font-size: 0.9rem;
            color: var(--accent-gold);
            margin-bottom: 2px;
        }

        .team-members {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            max-width: 100%;
        }

        .jumanji-logo {
            font-family: 'Creepster', cursive;
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            color: var(--accent-gold);
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.7);
            margin-bottom: 1rem;
            text-align: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .loading-container {
            background-color: rgba(26, 48, 9, 0.9);
            border: 2px solid var(--accent-gold);
            border-radius: 10px;
            padding: 1.2rem;
            max-width: min(85vw, 450px);
            width: 100%;
            text-align: center;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
            backdrop-filter: blur(5px);
        }

        .warning-text {
            font-family: 'Permanent Marker', cursive;
            font-size: clamp(0.9rem, 2.5vw, 1.2rem);
            color: var(--accent-red);
            margin-bottom: 0.6rem;
            text-shadow: 0 0 5px rgba(139, 0, 0, 0.7);
            animation: flicker 3s infinite;
        }

        @keyframes flicker {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.8;
            }
        }

        .message-text {
            font-size: clamp(0.85rem, 2vw, 1rem);
            margin-bottom: 0.8rem;
            line-height: 1.3;
        }

        .loading-spinner {
            width: 35px;
            height: 35px;
            border: 3px solid rgba(212, 175, 55, 0.3);
            border-top: 3px solid var(--accent-gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0.5rem auto 0.6rem;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .mysterious-text {
            font-family: 'Permanent Marker', cursive;
            font-size: clamp(0.95rem, 2.5vw, 1.1rem);
            color: var(--accent-gold);
            margin-top: 0.8rem;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(212, 175, 55, 0.8);
            animation: fadeInOut 5s infinite;
            letter-spacing: 1px;
        }

        @keyframes fadeInOut {

            0%,
            100% {
                opacity: 0;
            }

            50% {
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .video-background iframe {
                width: 150vw;
                height: 150vh;
            }

            .content-wrapper {
                padding: 0.5rem;
            }

            .team-info {
                max-width: 140px;
                padding: 6px 10px;
            }

            .loading-container {
                padding: 1rem;
            }
        }
    </style>
</head>

<body>
    <!-- Video Background -->
    <div class="video-background">
        <iframe
            src="https://www.youtube.com/embed/eGmdVnRR3x8?autoplay=1&mute=1&loop=1&playlist=eGmdVnRR3x8&controls=0&showinfo=0&modestbranding=1&iv_load_policy=3&rel=0&disablekb=1&start=12&end=102"
            frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
        </iframe>
    </div>

    <!-- Video Overlay -->
    <div class="video-overlay"></div>

    <!-- Content Wrapper -->
    <div class="content-wrapper">
        <!-- Top Section -->
        <div class="top-section">
            <div class="team-info">
                <div class="team-name" id="team-name">TEAM JUMANJI</div>
                <div class="team-members" id="team-members">4 Players</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <h1 class="jumanji-logo"><img src="./images/logo.png" style="width: 200px;height: 70px"></h1>

            <div class="loading-container">
                <div class="warning-text">
                    <i class="fas fa-exclamation-triangle"></i> DANGER AHEAD <i class="fas fa-exclamation-triangle"></i>
                </div>

                <p class="message-text">
                    Please wait... Your next challenge is being prepared. The jungle never sleeps.
                </p>

                <div class="loading-spinner"></div>

                <p class="message-text">
                    "In the jungle, you must wait... 'til the dice read five or eight."
                </p>

                <div id="mysterious-text">
                    DO NOT LOOK BEHIND YOU
                </div>
            </div>
        </div>

        <!-- Bottom Section (empty for spacing) -->
        <div></div>
    </div>
    <!-- Hidden Audio Player -->
    <audio id="bgm-player" loop>
        <source src="./audio/Jumanji.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script>
        function enableAudioOnInteraction() {
            const audio = document.getElementById('bgm-player');
            audio.play().catch(err => {
                console.log("Autoplay blocked:", err);
            });
            document.removeEventListener('click', enableAudioOnInteraction);
            document.removeEventListener('keydown', enableAudioOnInteraction);
        }

        // Attach on first interaction
        document.addEventListener('click', enableAudioOnInteraction);
        document.addEventListener('keydown', enableAudioOnInteraction);
    </script>



    <script>
        // Initialize Firebase with the provided configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDeu-PF9W3fHf7shBV-_aVRCEZ6atBCJ5E",
            authDomain: "jumanji-d14a9.firebaseapp.com",
            projectId: "jumanji-d14a9",
            storageBucket: "jumanji-d14a9.firebasestorage.app",
            messagingSenderId: "1008263887985",
            appId: "1:1008263887985:web:8be0e837e07bdecc9eafd0",
            databaseURL: "https://jumanji-d14a9-default-rtdb.asia-southeast1.firebasedatabase.app/"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // DOM Elements
        const teamName = document.getElementById('team-name');
        const teamMembers = document.getElementById('team-members');
        const mysteriousText = document.getElementById('mysterious-text');

        // State
        let teamData = null;

        // Get team data from session storage
        function getTeamData() {
            try {
                const teamCode = sessionStorage.getItem('teamCode');
                if (teamCode) {
                    // Fetch team data from Firebase
                    database.ref(`teams/${teamCode}`).once('value', (snapshot) => {
                        teamData = snapshot.val();
                        if (teamData) {
                            updateTeamInfo();
                        }
                    });
                }
            } catch (error) {
                console.error('Error getting team data:', error);
            }
        }

        // Update team information display
        function updateTeamInfo() {
            if (teamData) {
                teamName.textContent = `TEAM ${teamData.code}`;

                const players = teamData.players || [];
                const playerCount = players.length;
                teamMembers.textContent = `${playerCount} Player${playerCount !== 1 ? 's' : ''}`;
            }
        }



        // Listen for team updates
        function listenForTeamUpdates() {
            try {
                const teamCode = sessionStorage.getItem('teamCode');
                if (teamCode) {
                    database.ref(`teams/${teamCode}`).on('value', (snapshot) => {
                        teamData = snapshot.val();
                        if (teamData) {
                            updateTeamInfo();

                            // Check if team has been assigned a new location
                            if (teamData.status === 'assigned_location' && teamData.currentLocation) {
                                // Redirect to the new location
                                window.location.href = teamData.currentLocation;
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Error listening for team updates:', error);
            }
        }

        // Add random mysterious messages
        function addRandomMessages() {
            const messages = [
                "THE JUNGLE IS WATCHING...",
                "SOMETHING IS COMING...",
                "DON'T TURN AROUND...",
                "THEY KNOW YOU'RE HERE...",
                "THE GAME ISN'T OVER...",
                "YOUR NEXT MOVE COULD BE YOUR LAST...",
                "THE DRUMS ARE BEATING...",
                "CAN YOU HEAR THAT?",
                "IT'S GETTING CLOSER...",
                "RUN... BUT YOU CAN'T HIDE..."
            ];

            setInterval(() => {
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                mysteriousText.textContent = randomMessage;
            }, 6000);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            getTeamData();
            listenForTeamUpdates();
            addRandomMessages();
            initAudio();
        });
    </script>
</body>

</html>